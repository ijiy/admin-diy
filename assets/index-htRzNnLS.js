var K=Object.defineProperty;var B=s=>{throw TypeError(s)};var M=(s,t,i)=>t in s?K(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i;var x=(s,t,i)=>M(s,typeof t!="symbol"?t+"":t,i),L=(s,t,i)=>t.has(s)||B("Cannot "+i);var l=(s,t,i)=>(L(s,t,"read from private field"),i?i.call(s):t.get(s)),v=(s,t,i)=>t.has(s)?B("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,i),m=(s,t,i,d)=>(L(s,t,"write to private field"),d?d.call(s,i):t.set(s,i),i);import{i as O}from"./element-plus-hr2Rsl-r.js";import{d as j,K as A,ao as N,a7 as F,a2 as H,n as P,o as y,c as D,a as e,P as W,ag as z,W as p,u as _,b as T,R as V,V as S}from"./@vue-Qh5bA5yX.js";import"./lodash-es-ByZL8CPd.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-D9VHCHPz.js";import"./@element-plus-ByXdi8SP.js";import"./@ctrl-r5W6hzzQ.js";import"./@sxzz-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";const C=(s,t)=>Math.ceil(s-(Date.now()-t)/1e3);var n,h,r;class E{constructor(t,i){v(this,n,0);v(this,h);v(this,r);x(this,"status",0);x(this,"callback");this.callback=t,i&&this.start(i)}start(t){const i=Date.now()-1e3;m(this,n,C(t,i)),l(this,n)>0?(this.status=1,this.callback(l(this,n)),m(this,r,setInterval(()=>{m(this,n,C(t,i)),l(this,n)>0?this.callback(l(this,n)):(this.stop(),this.callback(0))},1e3))):(this.stop(),this.callback(0))}pause(){l(this,r)&&(this.status=2,m(this,h,Date.now()),clearInterval(l(this,r)))}goon(){l(this,h)&&(this.start(C(l(this,n),l(this,h))),m(this,h,void 0))}stop(){l(this,r)&&(clearInterval(l(this,r)),this.status=0,m(this,r,void 0),m(this,h,void 0))}}n=new WeakMap,h=new WeakMap,r=new WeakMap;const G={class:"qp-box mt-base"},J={class:"flex g-base mt-base"},Q={class:"mt-base"},U={class:"qp-box mt-base"},X={class:"mt-base"},Y={class:"flex mt-base"},R=60,ct=j({name:"NCountDown",__name:"index",setup(s){const t=A({dataList:[{id:"a_4",name:"计时d",time:360},{id:"a_3",name:"计时c",time:120},{id:"a_2",name:"计时b",time:60},{id:"a_1",name:"计时a",time:30}]}),i=N({time:360});new E(a=>{i.time=a},i.time);const d={};t.dataList.forEach(a=>{d[a.id]=new E(o=>{a.time=o,o||delete d[a.id]},a.time)});let b;F(()=>{b=Object.keys(d),b.forEach(a=>{d[a].pause()})}),H(()=>{b&&b.forEach(a=>{d[a].goon()})});const c=N({title:"开始",time:R});let f=!1;const u=new E(async a=>{c.time=a,a||(f=!0,await P(),c.title="重来")}),k=()=>{c.time=R,c.title="开始"},I=()=>{if(f){f=!1,k();return}switch(u.status){case 0:u.start(R),c.title="暂停";break;case 1:u.pause(),c.title="恢复";break;case 2:u.goon(),c.title="暂停";break}},q=()=>{f?(f=!1,k()):u.status&&(u.stop(),k())};return(a,o)=>{const g=O;return y(),D("div",null,[e("div",G,[o[0]||(o[0]=e("h2",{class:"c-title"},"数据集合示例",-1)),e("div",J,[(y(!0),D(W,null,z(_(t).dataList,w=>(y(),D("div",{key:w.id},p(w.name)+": "+p(w.time),1))),128))]),e("div",Q," 计时d: "+p(_(i).time)+" (用于对比, 该计时器离开页面不会停止) ",1),o[1]||(o[1]=e("ul",{class:"mt-base"},[e("li",null," 离开当前页面 (页面仍在内存或DOM中), 所有对应的计时器停止 "),e("li",{class:"mt-half"}," 返回当前页面, 倒计未结束继续计时 (如同从未停止过计时器) ")],-1))]),e("div",U,[o[3]||(o[3]=e("h2",{class:"c-title"},"操作示例",-1)),e("div",X,p(_(c).time),1),e("div",Y,[T(g,{type:"primary",onClick:I},{default:V(()=>[S(p(_(c).title),1)]),_:1}),T(g,{onClick:q},{default:V(()=>o[2]||(o[2]=[S(" 停止 ")])),_:1})]),o[4]||(o[4]=e("ul",{class:"mt-base"},[e("li",null,"从暂停中恢复, 时间的计算保持同步"),e("li",{class:"mt-half"},[S(" 场景示例: 页面加载后, 请求并同步服务器时间 "),e("ul",{class:"mt-base"},[e("li",null,"当应用onHide, 暂停时间"),e("li",{class:"mt-half"}," 当应用onShow, 恢复时间 (此时依旧同步服务器时间) ")])])],-1))])])}}});export{ct as default};
