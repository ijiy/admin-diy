var K=Object.defineProperty;var q=s=>{throw TypeError(s)};var M=(s,t,e)=>t in s?K(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var x=(s,t,e)=>M(s,typeof t!="symbol"?t+"":t,e),B=(s,t,e)=>t.has(s)||q("Cannot "+e);var o=(s,t,e)=>(B(s,t,"read from private field"),e?e.call(s):t.get(s)),p=(s,t,e)=>t.has(s)?q("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),h=(s,t,e,d)=>(B(s,t,"write to private field"),d?d.call(s,e):t.set(s,e),e);import{i as O}from"./element-plus-rtZK4mjR.js";import{d as j,X as A,al as L,a6 as F,b9 as H,n as Q,o as S,c as y,a,S as X,af as z,R as _,u as b,b as N,K as T,Q as R}from"./@vue-Bu2ox0Ej.js";import"./lodash-es-CbX0-HeL.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-BI9iYFro.js";import"./@element-plus-BaPZHkdt.js";import"./@ctrl-r5W6hzzQ.js";import"./@sxzz-D9SI2xQl.js";const D=(s,t)=>Math.ceil(s-(Date.now()-t)/1e3);var l,r,c;class C{constructor(t,e){p(this,l,0);p(this,r);p(this,c);x(this,"status",0);x(this,"callback");this.callback=t,e&&this.start(e)}start(t){const e=Date.now()-1e3;h(this,l,D(t,e)),o(this,l)>0?(this.status=1,this.callback(o(this,l)),h(this,c,setInterval(()=>{h(this,l,D(t,e)),o(this,l)>0?this.callback(o(this,l)):(this.stop(),this.callback(0))},1e3))):(this.stop(),this.callback(0))}pause(){o(this,c)&&(this.status=2,h(this,r,Date.now()),clearInterval(o(this,c)))}goon(){o(this,r)&&(this.start(D(o(this,l),o(this,r))),h(this,r,void 0))}stop(){o(this,c)&&(clearInterval(o(this,c)),this.status=0,h(this,c,void 0),h(this,r,void 0))}}l=new WeakMap,r=new WeakMap,c=new WeakMap;const G={class:"qp-box mt-base"},J=a("h2",{class:"qp-font-title color-title"},"数据集合示例",-1),P={class:"flex gap-base mt-base"},U={class:"mt-base"},W=a("ul",{class:"mt-base"},[a("li",null," 离开当前页面 (页面仍在内存或DOM中), 所有对应的计时器停止 "),a("li",{class:"mt-half"}," 返回当前页面, 倒计未结束继续计时 (如同从未停止过计时器) ")],-1),Y={class:"qp-box mt-base"},Z=a("h2",{class:"qp-font-title color-title"},"操作示例",-1),$={class:"mt-base"},tt={class:"flex mt-base"},st=a("ul",{class:"mt-base"},[a("li",null,"从暂停中恢复, 时间的计算保持同步"),a("li",{class:"mt-half"},[R(" 场景示例: 页面加载后, 请求并同步服务器时间 "),a("ul",{class:"mt-base"},[a("li",null,"当应用onHide, 暂停时间"),a("li",{class:"mt-half"}," 当应用onShow, 恢复时间 (此时依旧同步服务器时间) ")])])],-1),E=60,rt=j({name:"NCountDown",__name:"index",setup(s){const t=A({dataList:[{id:"a_4",name:"计时d",time:360},{id:"a_3",name:"计时c",time:120},{id:"a_2",name:"计时b",time:60},{id:"a_1",name:"计时a",time:30}]}),e=L({time:360});new C(i=>{e.time=i},e.time);const d={};t.dataList.forEach(i=>{d[i.id]=new C(k=>{i.time=k,k||delete d[i.id]},i.time)});let f;F(()=>{f=Object.keys(d),f.forEach(i=>{d[i].pause()})}),H(()=>{f&&f.forEach(i=>{d[i].goon()})});const n=L({title:"开始",time:E});let u=!1;const m=new C(async i=>{n.time=i,i||(u=!0,await Q(),n.title="重来")}),v=()=>{n.time=E,n.title="开始"},I=()=>{if(u){u=!1,v();return}switch(m.status){case 0:m.start(E),n.title="暂停";break;case 1:m.pause(),n.title="恢复";break;case 2:m.goon(),n.title="暂停";break}},V=()=>{u?(u=!1,v()):m.status&&(m.stop(),v())};return(i,k)=>{const g=O;return S(),y("div",null,[a("div",G,[J,a("div",P,[(S(!0),y(X,null,z(b(t).dataList,w=>(S(),y("div",{key:w.id},_(w.name)+": "+_(w.time),1))),128))]),a("div",U," 计时d: "+_(b(e).time)+" (用于对比, 该计时器离开页面不会停止) ",1),W]),a("div",Y,[Z,a("div",$,_(b(n).time),1),a("div",tt,[N(g,{type:"primary",onClick:I},{default:T(()=>[R(_(b(n).title),1)]),_:1}),N(g,{onClick:V},{default:T(()=>[R(" 停止 ")]),_:1})]),st])])}}});export{rt as default};
